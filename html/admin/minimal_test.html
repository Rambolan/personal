\u003c!DOCTYPE html\u003e
\u003chtml lang="zh-CN"\u003e
\u003chead\u003e
    \u003cmeta charset="UTF-8"\u003e
    \u003ctitle\u003e极简测试页面\u003c/title\u003e
    \u003cstyle\u003e
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #output {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            min-height: 200px;
            white-space: pre-wrap;
        }
        button {
            margin-right: 10px;
            padding: 5px 10px;
        }
    \u003c/style\u003e
\u003c/head\u003e
\u003cbody\u003e
    \u003h1\u003e极简API测试\u003c/h1\u003e
    \u003cbutton onclick="testGet()"\u003e测试GET请求\u003c/button\u003e
    \u003cbutton onclick="testPost()"\u003e测试POST请求\u003c/button\u003e
    \u003cbutton onclick="testLogin()"\u003e测试登录API\u003c/button\u003e
    \u003cdiv id="output"\u003e点击按钮开始测试...\u003c/div\u003e
    
    \u003cscript\u003e
        const output = document.getElementById('output');
        
        function log(message) {
            console.log(message);
            output.textContent += message + '\n';
            output.scrollTop = output.scrollHeight;
        }
        
        function clearOutput() {
            output.textContent = '';
        }
        
        // 测试GET请求
        function testGet() {
            clearOutput();
            log('开始测试GET请求...');
            
            const xhr = new XMLHttpRequest();
            
            // 监听所有事件
            xhr.addEventListener('readystatechange', function() {
                log(`状态变化: readyState=${this.readyState}, status=${this.status}`);
                if (this.readyState === 4) {
                    log('请求完成');
                    try {
                        const response = JSON.parse(this.responseText);
                        log('响应内容:', JSON.stringify(response, null, 2));
                    } catch (e) {
                        log('响应内容（原始）:', this.responseText);
                        log('解析错误:', e.message);
                    }
                }
            });
            
            xhr.addEventListener('error', function(e) {
                log('请求错误:', e.type);
            });
            
            xhr.addEventListener('timeout', function() {
                log('请求超时');
            });
            
            xhr.addEventListener('abort', function() {
                log('请求被中止');
            });
            
            // 设置超时
            xhr.timeout = 10000;
            
            // 发送请求
            xhr.open('GET', 'http://8.136.34.190:3000/api/test-connectivity', true);
            
            // 不设置自定义头部，减少预检请求
            
            log('发送GET请求...');
            xhr.send();
        }
        
        // 测试POST请求
        function testPost() {
            clearOutput();
            log('开始测试POST请求...');
            
            const xhr = new XMLHttpRequest();
            
            xhr.addEventListener('readystatechange', function() {
                log(`状态变化: readyState=${this.readyState}, status=${this.status}`);
                if (this.readyState === 4) {
                    log('请求完成');
                    try {
                        const response = JSON.parse(this.responseText);
                        log('响应内容:', JSON.stringify(response, null, 2));
                    } catch (e) {
                        log('响应内容（原始）:', this.responseText);
                        log('解析错误:', e.message);
                    }
                }
            });
            
            xhr.addEventListener('error', function(e) {
                log('请求错误:', e.type);
            });
            
            xhr.addEventListener('timeout', function() {
                log('请求超时');
            });
            
            xhr.addEventListener('abort', function() {
                log('请求被中止');
            });
            
            xhr.timeout = 10000;
            
            xhr.open('POST', 'http://8.136.34.190:3000/api/test-post', true);
            
            // 设置Content-Type
            xhr.setRequestHeader('Content-Type', 'application/json');
            
            const data = JSON.stringify({test: 'data', timestamp: new Date().toISOString()});
            log('请求数据:', data);
            
            log('发送POST请求...');
            xhr.send(data);
        }
        
        // 测试登录API
        function testLogin() {
            clearOutput();
            log('开始测试登录API...');
            
            const xhr = new XMLHttpRequest();
            
            xhr.addEventListener('readystatechange', function() {
                log(`状态变化: readyState=${this.readyState}, status=${this.status}`);
                if (this.readyState === 4) {
                    log('请求完成');
                    try {
                        const response = JSON.parse(this.responseText);
                        log('响应内容:', JSON.stringify(response, null, 2));
                    } catch (e) {
                        log('响应内容（原始）:', this.responseText);
                        log('解析错误:', e.message);
                    }
                }
            });
            
            xhr.addEventListener('error', function(e) {
                log('请求错误:', e.type);
            });
            
            xhr.addEventListener('timeout', function() {
                log('请求超时');
            });
            
            xhr.addEventListener('abort', function() {
                log('请求被中止');
            });
            
            xhr.timeout = 10000;
            
            xhr.open('POST', 'http://8.136.34.190:3000/api/users/login', true);
            
            // 设置Content-Type
            xhr.setRequestHeader('Content-Type', 'application/json');
            
            const data = JSON.stringify({username: 'admin', password: 'admin123'});
            log('请求数据:', data);
            
            log('发送登录请求...');
            xhr.send(data);
        }
    \u003c/script\u003e
\u003c/body\u003e
\u003c/html\u003e