<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°ç®¡ç†</title>
    <link rel="icon" href="../../favicon.ico" type="image/x-icon">
    <!-- CKEditor 5å¯Œæ–‡æœ¬ç¼–è¾‘å™¨CDN -->
    <script src="https://cdn.ckeditor.com/ckeditor5/39.0.2/classic/ckeditor.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #f5f7fa;
            display: flex;
            min-height: 100vh;
        }
        
        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 250px;
            background: #1e1e2f;
            color: white;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #2c2c3e;
        }
        
        .sidebar-header h1 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }
        
        .nav-item {
            list-style: none;
        }
        
        .nav-link {
            display: block;
            padding: 15px 25px;
            color: #a0aec0;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .nav-link:hover,
        .nav-link.active {
            background: #2c2c3e;
            color: white;
            border-left-color: #667eea;
        }
        
        .nav-link i {
            margin-right: 10px;
        }
        
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid #2c2c3e;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 15px;
        }
        
        .user-details h3 {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .user-details p {
            font-size: 12px;
            color: #a0aec0;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h2 {
            font-size: 24px;
            color: #2d3748;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .btn-danger {
            background: #e53e3e;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c53030;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
            margin-left: 10px;
        }
        
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        
        .content {
            flex: 1;
            padding: 20px;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 14px;
            color: #718096;
            font-weight: 500;
        }
        
        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-value {
            font-size: 28px;
            font-weight: 600;
            color: #2d3748;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .table-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-header h3 {
            font-size: 18px;
            color: #2d3748;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding: 8px 15px 8px 40px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            width: 250px;
        }
        
        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background-color: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }
        
        td {
            color: #2d3748;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 5px 12px;
            font-size: 14px;
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 20px;
            color: #2d3748;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #a0aec0;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #4a5568;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* å°é¢é¢„è§ˆæ ·å¼ */
        .cover-preview {
            width: 200px;
            height: 120px;
            border: 2px dashed #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
            background-color: #f9f9f9;
            position: relative;
            overflow: hidden;
        }
        
        .cover-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }
        
        .cover-preview span {
            color: #999;
            font-size: 14px;
        }
        
        .file-upload {
            display: flex;
            flex-direction: column;
        }
        
        /* çŠ¶æ€å’Œç²¾é€‰æ ‡ç­¾æ ·å¼ */
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-published {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-draft {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .featured-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .featured-yes {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .featured-no {
            background-color: #f3f4f6;
            color: #4b5563;
        }
        
        /* æ¶ˆæ¯æç¤º */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            background: #38a169;
        }
        
        .toast.error {
            background: #e53e3e;
        }
        
        .toast.info {
            background: #3182ce;
        }
        
        /* æ ‡ç­¾æ ·å¼ */
        .tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .tag-success {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .tag-danger {
            background: #fed7d7;
            color: #c53030;
        }
        
        .tag-warning {
            background: #feebc8;
            color: #c05621;
        }
        
        /* å›¾ç‰‡é¢„è§ˆæ ·å¼ */
        .image-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: move;
            user-select: none;
        }
        
        .image-preview-item:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        
        .image-preview-item .order-number {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .image-preview-item .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(229, 62, 62, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .image-preview-item:hover .delete-btn {
            display: flex;
        }
        
        .image-preview-item:hover .order-number {
            display: none;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            table {
                min-width: 600px;
            }
        }
    </style>
</head>
<body>
    <!-- ä¾§è¾¹æ  -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>ç®¡ç†æ§åˆ¶å°</h1>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#" class="nav-link active" id="products-link">
                    <i>ğŸ¨</i> ä½œå“ç®¡ç†
                </a>
            </li>

            <li class="nav-item">
                <a href="#" class="nav-link" id="users-link">
                    <i>ğŸ‘¥</i> ç”¨æˆ·ç®¡ç†
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" id="articles-link">
                    <i>ğŸ“</i> æ–‡ç« ç®¡ç†
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" id="settings-link">
                    <i>âš™ï¸</i> ç³»ç»Ÿè®¾ç½®
                </a>
            </li>
        </ul>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">AD</div>
                <div class="user-details">
                    <h3 id="user-name">ç®¡ç†å‘˜</h3>
                    <p id="user-role">è¶…çº§ç®¡ç†å‘˜</p>
                </div>
            </div>
        </div>
    </aside>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
        <header class="header">
            <h2 id="page-title">ä»ªè¡¨ç›˜</h2>
            <div class="header-actions">
                <span id="current-date"></span>
                <button class="btn btn-secondary" id="logout-btn">é€€å‡ºç™»å½•</button>
            </div>
        </header>
        
        <div class="content">
            
            <!-- ä½œå“ç®¡ç†å†…å®¹ -->
            <div id="products-content" class="page-content" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3>ä½œå“ç®¡ç†</h3>
                        <div class="search-box">
                            <i>ğŸ”</i>
                            <input type="text" placeholder="æœç´¢ä½œå“..." id="product-search">
                        </div>
                    </div>
                    
                    <div style="padding: 20px;">
                        <button class="btn btn-primary" id="add-product-btn">æ·»åŠ ä½œå“</button>
                    </div>
                    
                    <table id="products-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>æ ‡é¢˜</th>
                                <th>å°é¢</th>
                                <th>å–œæ¬¢ç¨‹åº¦</th>
                                <th>æ˜¯å¦ç²¾é€‰</th>
                                <th>å‘å¸ƒæ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
            </div>
            

            
            <!-- ç”¨æˆ·ç®¡ç†å†…å®¹ -->
            <div id="users-content" class="page-content" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3>ç”¨æˆ·ç®¡ç†</h3>
                        <div class="search-box">
                            <i>ğŸ”</i>
                            <input type="text" placeholder="æœç´¢ç”¨æˆ·..." id="user-search">
                        </div>
                    </div>
                    
                    <div style="padding: 20px;">
                        <button class="btn btn-primary" id="add-user-btn">æ·»åŠ ç”¨æˆ·</button>
                    </div>
                    
                    <table id="users-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ç”¨æˆ·å</th>
                                <th>é‚®ç®±</th>
                                <th>è§’è‰²</th>
                                <th>çŠ¶æ€</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ç³»ç»Ÿè®¾ç½®å†…å®¹ -->
            <div id="settings-content" class="page-content" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3>ç³»ç»Ÿè®¾ç½®</h3>
                    </div>
                    
                    <div style="padding: 20px;">
                        <form id="settings-form">
                            <div class="form-group">
                                <label for="site-title">ç½‘ç«™æ ‡é¢˜</label>
                                <input type="text" id="site-title" value="ä¸ªäººä½œå“é›†" placeholder="ç½‘ç«™æ ‡é¢˜">
                            </div>
                            
                            <div class="form-group">
                                <label for="site-description">ç½‘ç«™æè¿°</label>
                                <textarea id="site-description" placeholder="ç½‘ç«™æè¿°">æˆ‘çš„ä¸ªäººè®¾è®¡ä½œå“é›†ç½‘ç«™</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="site-keywords">å…³é”®è¯</label>
                                <input type="text" id="site-keywords" value="è®¾è®¡,ä½œå“é›†,UI,UX" placeholder="å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”">
                            </div>
                            
                            <div class="form-group">
                                <label for="page-size">æ¯é¡µæ˜¾ç¤ºæ•°é‡</label>
                                <select id="page-size">
                                    <option value="12">12</option>
                                    <option value="24">24</option>
                                    <option value="36">36</option>
                                </select>
                            </div>
                            
                            <div style="text-align: right; margin-top: 30px;">
                                <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- æ–‡ç« ç®¡ç†å†…å®¹ -->
            <div id="articles-content" class="page-content" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3>æ–‡ç« ç®¡ç†</h3>
                        <div class="search-box">
                            <input type="text" id="article-search" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜...">
                            <button class="btn btn-secondary" id="article-search-btn">æœç´¢</button>
                        </div>
                        
                    </div>
                    
                    <div class="table-controls">
                        <button class="btn btn-primary" id="add-article-btn">
                            æ·»åŠ æ–‡ç« 
                        </button>
                    </div>
                    
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ ‡é¢˜</th>
                                <th>å°é¢</th>
                                <th>çŠ¶æ€</th>
                                <th>æ˜¯å¦ç²¾é€‰</th>
                                <th>æµè§ˆé‡</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="article-table-body">
                            <!-- æ–‡ç« æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                    
                    <div class="pagination" id="article-pagination">
                        <!-- åˆ†é¡µå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- ä½œå“ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">æ·»åŠ ä½œå“</h3>
                <button class="modal-close" id="close-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="product-form">
                    <input type="hidden" id="product-id">
                    
                    <div class="form-group">
                        <label for="product-title">ä½œå“æ ‡é¢˜</label>
                        <input type="text" id="product-title" required placeholder="è¯·è¾“å…¥ä½œå“æ ‡é¢˜">
                    </div>
                    
                    <div class="form-group">
                        <label for="product-cover">ä½œå“å°é¢ï¼ˆåªèƒ½ä¸Šä¼ ä¸€å¼ ï¼‰</label>
                        <input type="file" id="product-cover" accept="image/*" required>
                        <div id="cover-preview" style="margin-top: 10px;">
                            <!-- å°é¢é¢„è§ˆä¼šåœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-images">ä½œå“å›¾ç‰‡ï¼ˆå¯ä¸Šä¼ å¤šå¼ ï¼Œåªåœ¨ä½œå“è¯¦æƒ…é¡µæ˜¾ç¤ºï¼‰</label>
                        <input type="file" id="product-images" accept="image/*" multiple>
                        <div id="images-preview" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px;">
                            <!-- ä½œå“å›¾ç‰‡é¢„è§ˆä¼šåœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-description">ä½œå“æè¿°</label>
                        <textarea id="product-description" placeholder="è¯·è¾“å…¥ä½œå“æè¿°"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-stars">å–œæ¬¢ç¨‹åº¦</label>
                        <select id="product-stars">
                            <option value="1">1 æ˜Ÿ</option>
                            <option value="2">2 æ˜Ÿ</option>
                            <option value="3" selected>3 æ˜Ÿ</option>
                            <option value="4">4 æ˜Ÿ</option>
                            <option value="5">5 æ˜Ÿ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-tags">è½¯ä»¶æ ‡ç­¾</label>
                        <input type="text" id="product-tags" placeholder="ä¾‹å¦‚ï¼šAPPè®¾è®¡,ç½‘é¡µè®¾è®¡ï¼Œç”¨é€—å·åˆ†éš”">
                    </div>
                    
                    <div class="form-group">
                        <label>æ˜¯å¦ç²¾é€‰ï¼ˆæ˜¾ç¤ºåœ¨é¦–é¡µï¼‰</label>
                        <div style="display: flex; gap: 20px; margin-top: 8px;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="radio" name="product-featured" id="product-featured-yes" value="true">
                                <span style="margin-left: 5px;">æ˜¯</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="radio" name="product-featured" id="product-featured-no" value="false" checked>
                                <span style="margin-left: 5px;">å¦</span>
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-modal">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="save-product">ä¿å­˜</button>
            </div>
        </div>
    </div>
    

    
    <!-- ç”¨æˆ·ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="user-modal-title">æ·»åŠ ç”¨æˆ·</h3>
                <button class="modal-close" id="close-user-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="user-form">
                    <input type="hidden" id="edit-user-id">
                    
                    <div class="form-group">
                        <label for="edit-username">ç”¨æˆ·å</label>
                        <input type="text" id="edit-username" required placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-email">é‚®ç®±</label>
                        <input type="email" id="edit-email" required placeholder="è¯·è¾“å…¥é‚®ç®±">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-password">å¯†ç </label>
                        <input type="password" id="edit-password" placeholder="ä¸ä¿®æ”¹è¯·ç•™ç©º">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-role">è§’è‰²</label>
                        <select id="edit-role">
                            <option value="editor">ç¼–è¾‘</option>
                            <option value="admin">ç®¡ç†å‘˜</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-status">çŠ¶æ€</label>
                        <select id="edit-status">
                            <option value="true" selected>å¯ç”¨</option>
                            <option value="false">ç¦ç”¨</option>
                        </select>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-user-modal">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="save-user">ä¿å­˜</button>
            </div>
    </div>
    </div>
    
    <!-- æ–‡ç« ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal" id="article-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="article-modal-title">æ·»åŠ æ–‡ç« </h3>
                <button class="modal-close" id="close-article-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="article-form">
                    <input type="hidden" id="article-id">
                    <div class="form-group">
                        <label for="article-title">æ–‡ç« æ ‡é¢˜ *</label>
                        <input type="text" id="article-title" placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜">
                    </div>
                    <div class="form-group">
                        <label for="article-cover">æ–‡ç« å°é¢ *</label>
                        <div class="file-upload">
                            <input type="file" id="article-cover" accept="image/*">
                            <div id="article-cover-preview" class="cover-preview">
                                <span>é¢„è§ˆåŒºåŸŸ</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="article-content">æ–‡ç« å†…å®¹ *</label>
                        <textarea id="article-content" rows="10" placeholder="è¯·è¾“å…¥æ–‡ç« å†…å®¹"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="article-status">çŠ¶æ€ *</label>
                        <select id="article-status">
                            <option value="published">å·²å‘å¸ƒ</option>
                            <option value="draft">è‰ç¨¿</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 8px;">æ˜¯å¦ç²¾é€‰</label>
                        <div class="radio-group" style="display: flex; gap: 20px; align-items: center;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="radio" name="article-featured" value="true" style="margin-right: 6px;">
                                <span style="user-select: none;">æ˜¯</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="radio" name="article-featured" value="false" checked style="margin-right: 6px;">
                                <span style="user-select: none;">å¦</span>
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-article-modal">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="save-article">ä¿å­˜</button>
            </div>
        </div>
    </div>
    
    <!-- æ¶ˆæ¯æç¤º -->
    <div class="toast" id="toast"></div>
    
    <script>
        // åˆå§‹åŒ–CKEditor 5å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
        let ckeditorInstance = null;
        
        function initCkeditor() {
            try {
                // é”€æ¯å·²å­˜åœ¨çš„ç¼–è¾‘å™¨å®ä¾‹
                if (ckeditorInstance) {
                    ckeditorInstance.destroy();
                }
                
                // è·å–textareaå…ƒç´ 
                const textarea = document.getElementById('article-content');
                if (!textarea) {
                    console.error('æœªæ‰¾åˆ°æ–‡ç« å†…å®¹textareaå…ƒç´ ');
                    return;
                }
                
                // åˆ›å»ºCKEditorå®ä¾‹
                ClassicEditor
                    .create(textarea, {
                        // é…ç½®å·¥å…·æ  - ä½¿ç”¨é»˜è®¤åŒ…å«çš„åŠŸèƒ½
                        toolbar: [
                                'heading', // æ ‡é¢˜
                                '|',
                                'bold',    // ç²—ä½“
                                'italic',  // æ–œä½“
                                '|',
                                'link',    // é“¾æ¥
                                'bulletedList', // æ— åºåˆ—è¡¨
                                'numberedList', // æœ‰åºåˆ—è¡¨
                                '|',
                                'blockquote', // å¼•ç”¨
                                'insertTable', // æ’å…¥è¡¨æ ¼
                                'imageUpload', // å›¾ç‰‡ä¸Šä¼ 
                                '|',
                                'undo',    // æ’¤é”€
                                'redo'     // é‡åš
                            ],
                        // é…ç½®æ ‡é¢˜é€‰é¡¹
                        heading: {
                            options: [
                                { model: 'paragraph', title: 'æ­£æ–‡', class: 'ck-heading_paragraph' },
                                { model: 'heading1', view: 'h1', title: 'æ ‡é¢˜ 1', class: 'ck-heading_heading1' },
                                { model: 'heading2', view: 'h2', title: 'æ ‡é¢˜ 2', class: 'ck-heading_heading2' },
                                { model: 'heading3', view: 'h3', title: 'æ ‡é¢˜ 3', class: 'ck-heading_heading3' }
                            ]
                        },
                        // é…ç½®å›¾ç‰‡ä¸Šä¼ 
                        image: {
                            toolbar: [
                                'imageTextAlternative',
                                'imageStyle:inline',
                                'imageStyle:block'
                            ]
                        },
                        // é…ç½®è¡¨æ ¼
                        table: {
                            contentToolbar: ['tableColumn', 'tableRow', 'mergeTableCells']
                        },
                        // é…ç½®åª’ä½“åµŒå…¥
                        mediaEmbed: {
                            previewsInData: true
                        }
                    })
                    .then(editor => {
                        // ä¿å­˜ç¼–è¾‘å™¨å®ä¾‹
                        ckeditorInstance = editor;
                        
                        // ç›‘å¬å†…å®¹å˜åŒ–äº‹ä»¶
                        editor.model.document.on('change:data', () => {
                            // å†…å®¹å˜åŒ–æ—¶è‡ªåŠ¨åŒæ­¥åˆ°textarea
                            textarea.value = editor.getData();
                        });
                        
                        // æ³¨å†Œä¸Šä¼ é€‚é…å™¨
                        editor.plugins.get('FileRepository').createUploadAdapter = (loader) => {
                            return new CustomUploadAdapter(loader);
                        };
                        
                        console.log('CKEditoråˆå§‹åŒ–æˆåŠŸ');
                    })
                    .catch(error => {
                        console.error('CKEditoråˆå§‹åŒ–å¤±è´¥:', error);
                        showToast('ç¼–è¾‘å™¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
                    });
            } catch (error) {
                console.error('åˆå§‹åŒ–ç¼–è¾‘å™¨æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showToast('ç¼–è¾‘å™¨åŠ è½½å¤±è´¥', 'error');
            }
        }
        
        // è‡ªå®šä¹‰ä¸Šä¼ é€‚é…å™¨ç±»
        class CustomUploadAdapter {
            constructor(loader) {
                this.loader = loader;
            }
            
            upload() {
                return this.loader.file
                    .then(file => new Promise((resolve, reject) => {
                        // æ£€æŸ¥æ–‡ä»¶å¤§å° (2MB)
                        const maxSize = 2 * 1024 * 1024;
                        if (file.size > maxSize) {
                            reject({
                                message: 'æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡2MB'
                            });
                            return;
                        }
                        
                        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                        const acceptedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/jpg'];
                        if (!acceptedTypes.includes(file.type)) {
                            reject({
                                message: 'åªæ”¯æŒJPGã€JPEGã€PNGå’ŒGIFæ ¼å¼çš„å›¾ç‰‡'
                            });
                            return;
                        }
                        
                        // åˆ›å»ºFormData
                        const formData = new FormData();
                        formData.append('cover', file); // åç«¯æœŸæœ›çš„å­—æ®µåæ˜¯'cover'
                        
                        // å‘é€ä¸Šä¼ è¯·æ±‚
                        const xhr = new XMLHttpRequest();
                        
                        xhr.upload.addEventListener('progress', evt => {
                            if (evt.lengthComputable) {
                                const percentComplete = evt.loaded / evt.total;
                                this.loader.uploadTotal = evt.total;
                                this.loader.uploaded = evt.loaded;
                            }
                        });
                        
                        xhr.addEventListener('error', () => {
                            reject({
                                message: 'ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥'
                            });
                        });
                        
                        xhr.addEventListener('abort', () => {
                            reject();
                        });
                        
                        xhr.addEventListener('load', () => {
                            const response = JSON.parse(xhr.responseText);
                            
                            if (xhr.status !== 200 || !response.success) {
                                reject({
                                    message: response.message || 'ä¸Šä¼ å¤±è´¥'
                                });
                                return;
                            }
                            
                            // ä¸Šä¼ æˆåŠŸï¼Œè¿”å›å›¾ç‰‡URL
                            // ç¡®ä¿è¿”å›å®Œæ•´çš„åç«¯æœåŠ¡å™¨URLï¼Œä½¿ç”¨æ­£ç¡®çš„ç«¯å£å·3000
                            let imageUrl = response.location;
                            if (imageUrl && imageUrl.startsWith('/uploads/')) {
                                // å°†ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºå®Œæ•´çš„åç«¯æœåŠ¡å™¨URLï¼Œä½¿ç”¨3000ç«¯å£
                                imageUrl = 'http://8.136.34.190:3000' + imageUrl;
                            }
                            
                            resolve({
                                default: imageUrl
                            });
                            
                            showToast('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', 'success');
                        });
                        
                        // ä½¿ç”¨åç«¯æœåŠ¡å™¨å®Œæ•´åœ°å€ï¼Œç¡®ä¿è¯·æ±‚å‘é€åˆ°æ­£ç¡®çš„æœåŠ¡å™¨
                        xhr.open('POST', 'http://8.136.34.190:3000/api/editor/upload');
                        xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.getItem('adminToken'));
                        xhr.withCredentials = true;
                        
                        // å‘é€è¯·æ±‚
                        xhr.send(formData);
                    }));
            }
            
            abort() {
                // å®ç°å–æ¶ˆä¸Šä¼ çš„é€»è¾‘
            }
        }
        
        // æ³¨å†Œä¸Šä¼ é€‚é…å™¨å·¥å‚
        function uploadAdapterPlugin(editor) {
            editor.plugins.get('FileRepository').createUploadAdapter = (loader) => {
                return new CustomUploadAdapter(loader);
            };
        }
        
        // ä¿å­˜ç¼–è¾‘å™¨å†…å®¹åˆ°textarea
        function saveEditorContent() {
            try {
                if (ckeditorInstance) {
                    const textarea = document.getElementById('article-content');
                    if (textarea) {
                        textarea.value = ckeditorInstance.getData();
                    }
                }
            } catch (error) {
                console.error('ä¿å­˜ç¼–è¾‘å™¨å†…å®¹å¤±è´¥:', error);
                // ç»§ç»­ä½¿ç”¨textareaçš„å†…å®¹
            }
        }
        
        // é”€æ¯ç¼–è¾‘å™¨å®ä¾‹
        function destroyEditor() {
            try {
                if (ckeditorInstance) {
                    ckeditorInstance.destroy();
                    ckeditorInstance = null;
                }
            } catch (error) {
                console.error('é”€æ¯ç¼–è¾‘å™¨å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            checkLogin();
            
            // åˆå§‹åŒ–é¡µé¢
            initPage();
            
            // ç»‘å®šå¯¼èˆªäº‹ä»¶
            bindNavigation();
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            bindButtonEvents();
            
            // åˆå§‹åŒ–TinyMCEå¯Œæ–‡æœ¬ç¼–è¾‘å™¨
            // éœ€è¦ç­‰å¾…æ¨¡æ€æ¡†å‡ºç°åå†åˆå§‹åŒ–ï¼Œè¿™é‡Œå…ˆä¸åˆå§‹åŒ–
        });
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLogin() {
            const token = localStorage.getItem('adminToken');
            const userInfo = localStorage.getItem('adminUser');
            
            if (!token || !userInfo) {
                // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
                window.location.href = 'login.html';
                return false;
            }
            
            // æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ
            try {
                const decodedToken = parseJwt(token);
                if (decodedToken.exp < Date.now() / 1000) {
                    // tokenå·²è¿‡æœŸ
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('adminUser');
                    showToast('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'error');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                    return false;
                }
            } catch (e) {
                // tokenè§£æå¤±è´¥
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                window.location.href = 'login.html';
                return false;
            }
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            try {
                const user = JSON.parse(userInfo);
                document.getElementById('user-name').textContent = user.username;
                document.getElementById('user-role').textContent = user.role === 'admin' ? 'è¶…çº§ç®¡ç†å‘˜' : 'ç¼–è¾‘';
                document.getElementById('user-avatar').textContent = user.username.charAt(0).toUpperCase();
            } catch (e) {
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                window.location.href = 'login.html';
                return false;
            }
            
            return true;
        }
        
        // è§£æJWT token
        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            
            return JSON.parse(jsonPayload);
        }
        
        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            // è®¾ç½®å½“å‰æ—¥æœŸ
            const now = new Date();
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('zh-CN', dateOptions);
            
            // é»˜è®¤æ˜¾ç¤ºä½œå“ç®¡ç†é¡µé¢
            document.getElementById('page-title').textContent = 'ä½œå“ç®¡ç†';
            document.getElementById('products-content').style.display = 'block';
            loadProducts(); // å¯ç”¨åŠ è½½ä½œå“æ•°æ®
        }
        
        // ç»‘å®šå¯¼èˆªäº‹ä»¶
        function bindNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const pageContents = document.querySelectorAll('.page-content');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    navLinks.forEach(l => l.classList.remove('active'));
                    
                    // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                    this.classList.add('active');
                    
                    // éšè—æ‰€æœ‰å†…å®¹
                    pageContents.forEach(content => content.style.display = 'none');
                    
                    // æ˜¾ç¤ºå¯¹åº”å†…å®¹
                    const linkId = this.id;
                    let contentId = '';
                    
                    if (linkId === 'products-link') {
                        contentId = 'products-content';
                        document.getElementById('page-title').textContent = 'ä½œå“ç®¡ç†';
                        loadProducts();
                    }
                    
                    if (linkId === 'users-link') {
                        contentId = 'users-content';
                        document.getElementById('page-title').textContent = 'ç”¨æˆ·ç®¡ç†';
                        loadUsers();
                    }
                    
                    if (linkId === 'settings-link') {
                        contentId = 'settings-content';
                        document.getElementById('page-title').textContent = 'ç³»ç»Ÿè®¾ç½®';
                    }
                    
                    if (linkId === 'articles-link') {
                        contentId = 'articles-content';
                        document.getElementById('page-title').textContent = 'æ–‡ç« ç®¡ç†';
                        loadArticles();
                    }
                    
                    if (contentId) {
                        document.getElementById(contentId).style.display = 'block';
                    }
                });
            });
        }
        
        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        function bindButtonEvents() {
            // é€€å‡ºç™»å½•
            document.getElementById('logout-btn').addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('adminUser');
                    window.location.href = 'login.html';
                }
            });
            
            // æ·»åŠ ä½œå“æŒ‰é’®
            document.getElementById('add-product-btn').addEventListener('click', function() {
                openProductModal();
            });
            
            // æ·»åŠ ç”¨æˆ·æŒ‰é’®
            document.getElementById('add-user-btn').addEventListener('click', function() {
                openUserModal();
            });
            
            // å…³é—­æ¨¡æ€æ¡†
            document.getElementById('close-modal').addEventListener('click', closeProductModal);
            document.getElementById('cancel-modal').addEventListener('click', closeProductModal);
            
            // å…³é—­ç”¨æˆ·æ¨¡æ€æ¡†
            document.getElementById('close-user-modal').addEventListener('click', closeUserModal);
            document.getElementById('cancel-user-modal').addEventListener('click', closeUserModal);
            
            // ä¿å­˜ä½œå“
            document.getElementById('save-product').addEventListener('click', saveProduct);
            
            // ä¿å­˜ç”¨æˆ·
            document.getElementById('save-user').addEventListener('click', saveUser);
            
            // æ·»åŠ æ–‡ç« æŒ‰é’®
            document.getElementById('add-article-btn').addEventListener('click', function() {
                openArticleModal();
            });
            
            // å…³é—­æ–‡ç« æ¨¡æ€æ¡†
            document.getElementById('close-article-modal').addEventListener('click', closeArticleModal);
            document.getElementById('cancel-article-modal').addEventListener('click', closeArticleModal);
            
            // ä¿å­˜æ–‡ç« 
            document.getElementById('save-article').addEventListener('click', saveArticle);
            
            // æ–‡ç« æœç´¢
            document.getElementById('article-search-btn').addEventListener('click', function() {
                const searchTerm = document.getElementById('article-search').value.trim();
                loadArticles(1, searchTerm);
            });
            
            // æ–‡ç« æœç´¢æ¡†å›è½¦äº‹ä»¶
            document.getElementById('article-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const searchTerm = e.target.value.trim();
                    loadArticles(1, searchTerm);
                }
            });
            
            // ä¿å­˜è®¾ç½®
            document.getElementById('settings-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSettings();
            });
            
            // å·²ç§»é™¤å°é¢é¢„è§ˆï¼Œä½¿ç”¨ç»Ÿä¸€çš„å›¾ç‰‡ä¸Šä¼ é¢„è§ˆ
            
            // ä½œå“å°é¢é¢„è§ˆ
            document.getElementById('product-cover').addEventListener('change', function(e) {
                const file = e.target.files[0];
                const previewContainer = document.getElementById('cover-preview');
                
                // æ¸…ç©ºç°æœ‰é¢„è§ˆ
                previewContainer.innerHTML = '';
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const previewItem = document.createElement('div');
                        previewItem.style.position = 'relative';
                        
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        img.style.maxWidth = '200px';
                        img.style.maxHeight = '150px';
                        img.style.objectFit = 'cover';
                        img.style.borderRadius = '4px';
                        img.style.border = '2px solid #3182ce';
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.textContent = 'Ã—';
                        removeBtn.style.position = 'absolute';
                        removeBtn.style.top = '-10px';
                        removeBtn.style.right = '-10px';
                        removeBtn.style.background = 'red';
                        removeBtn.style.color = 'white';
                        removeBtn.style.border = 'none';
                        removeBtn.style.borderRadius = '50%';
                        removeBtn.style.width = '20px';
                        removeBtn.style.height = '20px';
                        removeBtn.style.display = 'flex';
                        removeBtn.style.alignItems = 'center';
                        removeBtn.style.justifyContent = 'center';
                        removeBtn.style.cursor = 'pointer';
                        removeBtn.addEventListener('click', function() {
                            previewItem.remove();
                            document.getElementById('product-cover').value = '';
                        });
                        
                        previewItem.appendChild(img);
                        previewItem.appendChild(removeBtn);
                        previewContainer.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // ä½œå“å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
        }
        

        
        // åŠ è½½ä½œå“åˆ—è¡¨
        async function loadProducts() {
            try {
                const token = localStorage.getItem('adminToken');
                // ä¿®æ”¹ä¸ºæŒ‡å‘åç«¯3000ç«¯å£
            const response = await fetch('http://8.136.34.190:3000/api/products/admin/list', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        // è®¤è¯å¤±è´¥ï¼Œæ¸…é™¤tokenå¹¶è·³è½¬åˆ°ç™»å½•é¡µ
                        localStorage.removeItem('adminToken');
                        localStorage.removeItem('adminUser');
                        showToast('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'error');
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 1500);
                        return;
                    }
                    throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                }
                
                const data = await response.json();
                
                if (data.success) {
                    renderProductsTable(data.data);
                } else {
                    showToast(data.message || 'åŠ è½½ä½œå“å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('åŠ è½½ä½œå“å¤±è´¥', 'error');
                console.error('åŠ è½½ä½œå“å¤±è´¥:', error);
            }
        }
        
        // æ¸²æŸ“ä½œå“è¡¨æ ¼
        function renderProductsTable(products) {
            const tbody = document.getElementById('products-table').querySelector('tbody');
            tbody.innerHTML = '';
            
            if (!products || products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #718096;">
                            æš‚æ— ä½œå“æ•°æ®
                        </td>
                    </tr>
                `;
                return;
            }
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${escapeHtml(product.title)}</td>
                    <td>
                        <img src="${product.cover}" width="60" height="40" style="object-fit: cover; border-radius: 4px;">
                    </td>
                    <td>
                            ${Array.from({length: 5}, (_, i) => 
                                i < (product.stars || 0) 
                                    ? '<span style="color: #FFD700;">â˜…</span>' 
                                    : '<span style="color: #E5E7EB;">â˜…</span>'
                            ).join('')}
                        </td>
                        <td>
                            <span class="tag tag-${product.featured ? 'success' : 'danger'}">
                                ${product.featured ? 'æ˜¯' : 'å¦'}
                            </span>
                        </td>
                        <td>${formatDate(product.date)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="editProduct(${product.id})")>ç¼–è¾‘</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id}, '${escapeHtml(product.title)}')">åˆ é™¤</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        async function loadUsers() {
            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('http://8.136.34.190:3000/api/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    renderUsersTable(data.data);
                }
            } catch (error) {
                showToast('åŠ è½½ç”¨æˆ·å¤±è´¥', 'error');
                console.error('åŠ è½½ç”¨æˆ·å¤±è´¥:', error);
            }
        }
        
        // æ¸²æŸ“ç”¨æˆ·è¡¨æ ¼
        function renderUsersTable(users) {
            const tbody = document.getElementById('users-table').querySelector('tbody');
            tbody.innerHTML = '';
            
            if (!users || users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #718096;">
                            æš‚æ— ç”¨æˆ·æ•°æ®
                        </td>
                    </tr>
                `;
                return;
            }
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${escapeHtml(user.username)}</td>
                    <td>${escapeHtml(user.email || '')}</td>
                    <td>
                        <span class="tag tag-${user.role === 'admin' ? 'warning' : 'info'}">
                            ${user.role === 'admin' ? 'ç®¡ç†å‘˜' : 'ç¼–è¾‘'}
                        </span>
                    </td>
                    <td>
                        <span class="tag tag-${user.status ? 'success' : 'danger'}">
                            ${user.status ? 'å¯ç”¨' : 'ç¦ç”¨'}
                        </span>
                    </td>
                    <td>${formatDate(user.createdAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="editUser(${user.id})")>ç¼–è¾‘</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id}, '${escapeHtml(user.username)}')">åˆ é™¤</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // æ‰“å¼€ä½œå“æ¨¡æ€æ¡†
            function openProductModal() {
                document.getElementById('modal-title').textContent = 'æ·»åŠ ä½œå“';
                document.getElementById('product-form').reset();
                document.getElementById('product-id').value = '';
                document.getElementById('cover-preview').innerHTML = '';
                document.getElementById('images-preview').innerHTML = '';
                
                // é‡ç½®å›¾ç‰‡é¡ºåºæ•°ç»„
                imageOrder = [];
                
                document.getElementById('product-modal').style.display = 'flex';
            }
        
        // å…³é—­ä½œå“æ¨¡æ€æ¡†
        function closeProductModal() {
            document.getElementById('product-modal').style.display = 'none';
            
            // é‡ç½®è¡¨å•
            document.getElementById('product-form').reset();
            document.getElementById('product-id').value = '';
            
            // æ¸…ç©ºå›¾ç‰‡é¢„è§ˆå®¹å™¨
            const coverPreview = document.getElementById('cover-preview');
            const imagesPreview = document.getElementById('images-preview');
            coverPreview.innerHTML = '';
            imagesPreview.innerHTML = '';
            
            // é‡ç½®å›¾ç‰‡é¡ºåºæ•°ç»„
            imageOrder = [];
            
            // é‡ç½®æ¨¡æ€æ¡†æ ‡é¢˜
            document.getElementById('modal-title').textContent = 'æ·»åŠ ä½œå“';
        }
        
        // æ‰“å¼€ç”¨æˆ·æ¨¡æ€æ¡†
        function openUserModal() {
            document.getElementById('user-modal-title').textContent = 'æ·»åŠ ç”¨æˆ·';
            document.getElementById('user-form').reset();
            document.getElementById('edit-user-id').value = '';
            document.getElementById('user-modal').style.display = 'flex';
        }
        
        // å…³é—­ç”¨æˆ·æ¨¡æ€æ¡†
        function closeUserModal() {
            document.getElementById('user-modal').style.display = 'none';
        }
        
        // ä¿å­˜ä½œå“
        async function saveProduct() {
            await saveProductWithOrder();
        }
        
        // ä¿å­˜ç”¨æˆ·
        async function saveUser() {
            const id = document.getElementById('edit-user-id').value;
            const username = document.getElementById('edit-username').value;
            const email = document.getElementById('edit-email').value;
            const password = document.getElementById('edit-password').value;
            const role = document.getElementById('edit-role').value;
            const status = document.getElementById('edit-status').value === 'true';
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            if (!username || !email) {
                showToast('è¯·å¡«å†™å¿…å¡«å­—æ®µ', 'error');
                return;
            }
            
            try {
                const token = localStorage.getItem('adminToken');
                let response;
                
                const userData = {
                    username,
                    email,
                    role,
                    status
                };
                
                // åªæœ‰åœ¨å¡«å†™äº†å¯†ç æ—¶æ‰æ›´æ–°å¯†ç 
                if (password) {
                    userData.password = password;
                }
                
                if (id) {
                    // æ›´æ–°ç”¨æˆ·
                    response = await fetch(`/api/users/${id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(userData)
                    });
                } else {
                    // æ·»åŠ ç”¨æˆ·
                    if (!password) {
                        showToast('æ·»åŠ ç”¨æˆ·å¿…é¡»è®¾ç½®å¯†ç ', 'error');
                        return;
                    }
                    
                    response = await fetch('http://8.136.34.190:3000/api/users', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(userData)
                    });
                }
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(id ? 'æ›´æ–°æˆåŠŸ' : 'æ·»åŠ æˆåŠŸ', 'success');
                    closeUserModal();
                    loadUsers();
                    // ç§»é™¤å¯¹æœªå®šä¹‰å‡½æ•°çš„è°ƒç”¨
                    // loadDashboardData();
                } else {
                    showToast(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('æ“ä½œå¤±è´¥', 'error');
                console.error('ä¿å­˜ç”¨æˆ·å¤±è´¥:', error);
            }
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            // è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿä¿å­˜è®¾ç½®
            showToast('è®¾ç½®å·²ä¿å­˜', 'success');
        }
        
        // ç¼–è¾‘ä½œå“
            async function editProduct(id) {
                try {
                    const token = localStorage.getItem('adminToken');
                    const response = await fetch(`http://8.136.34.190:3000/api/products/admin/list`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        const product = data.data.find(p => p.id === id);
                        
                        if (product) {
                            document.getElementById('modal-title').textContent = 'ç¼–è¾‘ä½œå“';
                            document.getElementById('product-id').value = product.id;
                            document.getElementById('product-title').value = product.title;
                            document.getElementById('product-description').value = product.description || '';
                            document.getElementById('product-stars').value = product.stars || 3;
                            document.getElementById('product-tags').value = product.tags ? product.tags.join(', ') : '';
                            // è®¾ç½®å•é€‰æ¡†é€‰ä¸­çŠ¶æ€
                            document.getElementById('product-featured-yes').checked = product.featured || false;
                            document.getElementById('product-featured-no').checked = !(product.featured || false);
                            
                            // æ¸…ç©ºå›¾ç‰‡é¢„è§ˆå®¹å™¨
                            const coverPreview = document.getElementById('cover-preview');
                            const imagesPreview = document.getElementById('images-preview');
                            coverPreview.innerHTML = '';
                            imagesPreview.innerHTML = '';
                            
                            // æ˜¾ç¤ºå°é¢
                            if (product.cover) {
                                const coverImg = document.createElement('div');
                                coverImg.style.position = 'relative';
                                coverImg.style.border = '2px solid #3182ce';
                                coverImg.style.borderRadius = '8px';
                                
                                const img = document.createElement('img');
                                // æ£€æŸ¥æ˜¯å¦ä¸ºå®Œæ•´URLï¼Œä¸æ˜¯åˆ™æ·»åŠ åç«¯æœåŠ¡å™¨åœ°å€
                        const coverUrl = product.cover;
                        img.src = coverUrl;
                                img.style.maxWidth = '200px';
                                img.style.maxHeight = '150px';
                                img.style.objectFit = 'cover';
                                img.style.borderRadius = '6px';
                                
                                const label = document.createElement('span');
                                label.textContent = 'å½“å‰å°é¢';
                                label.style.position = 'absolute';
                                label.style.bottom = '0';
                                label.style.right = '0';
                                label.style.background = '#3182ce';
                                label.style.color = 'white';
                                label.style.padding = '2px 8px';
                                label.style.fontSize = '12px';
                                label.style.borderRadius = '4px';
                                
                                coverImg.appendChild(img);
                                coverImg.appendChild(label);
                                coverPreview.appendChild(coverImg);
                            }
                            
                            // æ˜¾ç¤ºä½œå“å›¾ç‰‡å¹¶æ”¯æŒå¢é‡ä¸Šä¼ 
                            if (product.images && product.images.length > 0) {
                                // æ¸…ç©ºé¢„è§ˆåŒºå’Œæ•°ç»„
                                imagesPreview.innerHTML = '';
                                imageOrder = [];
                                
                                // å…ˆæŒ‰orderå­—æ®µæ’åºå›¾ç‰‡
                                const sortedImages = [...product.images].sort((a, b) => {
                                    const orderA = typeof a === 'object' ? (a.order || 0) : 0;
                                    const orderB = typeof b === 'object' ? (b.order || 0) : 0;
                                    return orderA - orderB;
                                });
                                
                                console.log('ç¼–è¾‘ä½œå“ - æŒ‰orderæ’åºåçš„å›¾ç‰‡:', sortedImages);
                                
                                sortedImages.forEach((imageObj, index) => {
                                    const imageUrl = typeof imageObj === 'object' ? imageObj.url : imageObj;
                                    
                                    // ä¿®å¤ï¼šè¿‡æ»¤æ‰base64æ ¼å¼çš„å›¾ç‰‡URLï¼Œåªæ˜¾ç¤ºæœ‰æ•ˆçš„æœåŠ¡å™¨å›¾ç‰‡
                                    if (imageUrl && !imageUrl.startsWith('data:image')) {
                                        const imageContainer = createImagePreviewItem(imageUrl, index, false);
                                        imagesPreview.appendChild(imageContainer);
                                        
                                        // è·å–å½“å‰å›¾ç‰‡åœ¨æ•°æ®åº“ä¸­çš„å®é™…orderå€¼
                                        const currentOrder = typeof imageObj === 'object' && imageObj.order ? imageObj.order : (index + 1);
                                        
                                        imageOrder.push({
                                            url: imageUrl,
                                            order: currentOrder,
                                            file: null, // ç¼–è¾‘æ—¶æ²¡æœ‰æ–‡ä»¶å¯¹è±¡
                                            isNew: false, // æ ‡è®°ä¸ºç°æœ‰å›¾ç‰‡
                                            originalIndex: index // ä¿å­˜åŸå§‹ç´¢å¼•ï¼Œç”¨äºAPIè°ƒç”¨
                                        });
                                    } else {
                                        console.warn('è·³è¿‡æ— æ•ˆçš„å›¾ç‰‡URL:', imageUrl);
                                    }
                                });
                                
                                console.log('ç¼–è¾‘ä½œå“ - imageOrderæ•°ç»„:', imageOrder);
                            } else {
                                // å¦‚æœæ²¡æœ‰å›¾ç‰‡ï¼Œç¡®ä¿æ¸…ç©ºé¢„è§ˆåŒºå’Œæ•°ç»„
                                imagesPreview.innerHTML = '';
                                imageOrder = [];
                                console.log('ç¼–è¾‘ä½œå“ - æ²¡æœ‰ç°æœ‰å›¾ç‰‡ï¼Œå·²æ¸…ç©ºé¢„è§ˆåŒºå’Œæ•°ç»„');
                            }
                            
                            // æ·»åŠ æç¤ºæ–‡æœ¬
                            const coverInfoText = document.createElement('div');
                            coverInfoText.textContent = 'æç¤ºï¼šé‡æ–°é€‰æ‹©å°é¢å°†æ›¿æ¢ç°æœ‰å°é¢';
                            coverInfoText.style.color = '#666';
                            coverInfoText.style.fontSize = '12px';
                            coverInfoText.style.marginTop = '10px';
                            coverPreview.appendChild(coverInfoText);
                            
                            const imagesInfoText = document.createElement('div');
                            imagesInfoText.textContent = 'æç¤ºï¼šé€‰æ‹©æ–°å›¾ç‰‡å°†æ·»åŠ åˆ°ç°æœ‰å›¾ç‰‡ä¸­ï¼Œå¯å•ç‹¬åˆ é™¤';
                            imagesInfoText.style.color = '#666';
                            imagesInfoText.style.fontSize = '12px';
                            imagesInfoText.style.marginTop = '10px';
                            imagesPreview.appendChild(imagesInfoText);
                        
                        document.getElementById('product-modal').style.display = 'flex';
                    }
                }
            } catch (error) {
                showToast('è·å–ä½œå“ä¿¡æ¯å¤±è´¥', 'error');
                console.error('ç¼–è¾‘ä½œå“å¤±è´¥:', error);
            }
        }
        
        // ç¼–è¾‘ç”¨æˆ·
        async function editUser(id) {
            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('/api/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const user = data.data.find(u => u.id === id);
                    
                    if (user) {
                        document.getElementById('user-modal-title').textContent = 'ç¼–è¾‘ç”¨æˆ·';
                        document.getElementById('edit-user-id').value = user.id;
                        document.getElementById('edit-username').value = user.username;
                        document.getElementById('edit-email').value = user.email || '';
                        document.getElementById('edit-password').value = '';
                        document.getElementById('edit-role').value = user.role;
                        document.getElementById('edit-status').value = user.status.toString();
                        document.getElementById('user-modal').style.display = 'flex';
                    }
                }
            } catch (error) {
                showToast('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥', 'error');
                console.error('ç¼–è¾‘ç”¨æˆ·å¤±è´¥:', error);
            }
        }
        
        // åˆ é™¤ä½œå“
        async function deleteProduct(id, title) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ä½œå“"${title}"å—ï¼Ÿ`)) {
                try {
                    const token = localStorage.getItem('adminToken');
                    const response = await fetch(`http://8.136.34.190:3000/api/products/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showToast('åˆ é™¤æˆåŠŸ', 'success');
                        loadProducts();
                    } else {
                        showToast(data.message || 'åˆ é™¤å¤±è´¥', 'error');
                    }
                } catch (error) {
                    showToast('åˆ é™¤å¤±è´¥', 'error');
                    console.error('åˆ é™¤ä½œå“å¤±è´¥:', error);
                }
            }
        }
        
        // åˆ é™¤ç”¨æˆ·
        async function deleteUser(id, username) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ·"${username}"å—ï¼Ÿ`)) {
                try {
                    const token = localStorage.getItem('adminToken');
                    const response = await fetch(`/api/users/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showToast('åˆ é™¤æˆåŠŸ', 'success');
                        loadUsers();
                        // ç§»é™¤å¯¹æœªå®šä¹‰å‡½æ•°çš„è°ƒç”¨
                        // loadDashboardData();
                    } else {
                        showToast(data.message || 'åˆ é™¤å¤±è´¥', 'error');
                    }
                } catch (error) {
                    showToast('åˆ é™¤å¤±è´¥', 'error');
                    console.error('åˆ é™¤ç”¨æˆ·å¤±è´¥:', error);
                }
            }
        }
        
        // æ–‡ç« ç®¡ç†ç›¸å…³åŠŸèƒ½
        let currentPage = 1;
        const pageSize = 10;
        
        // åŠ è½½æ–‡ç« åˆ—è¡¨
        async function loadArticles(page = 1, search = '') {
            currentPage = page;
            try {
                const token = localStorage.getItem('adminToken');
                let url = `http://8.136.34.190:3000/api/articles/admin/list?page=${page}&pageSize=${pageSize}`;
                if (search) {
                    url += `&search=${encodeURIComponent(search)}`;
                }
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const tableBody = document.getElementById('article-table-body');
                    tableBody.innerHTML = '';
                    
                    data.data.articles.forEach(article => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${article.title}</td>
                            <td>
                                ${article.cover ? `<img src="${article.cover}" alt="å°é¢" style="width: 60px; height: 40px; object-fit: cover;">` : 'æ— '}
                            </td>
                            <td>
                                <span class="status-badge ${article.status ? 'status-published' : 'status-draft'}">
                                    ${article.status ? 'å·²å‘å¸ƒ' : 'è‰ç¨¿'}
                                </span>
                            </td>
                            <td>
                                <span class="featured-badge ${article.isFeatured ? 'featured-yes' : 'featured-no'}">
                                    ${article.isFeatured ? 'æ˜¯' : 'å¦'}
                                </span>
                            </td>
                            <td>${article.viewCount || 0}</td>
                            <td>${formatDate(article.createdAt)}</td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="editArticle(${article.id})">ç¼–è¾‘</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteArticle(${article.id}, '${escapeHtml(article.title)}')">åˆ é™¤</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                    
                    // ç”Ÿæˆåˆ†é¡µ
                    generateArticlePagination(data.data.totalPages, page);
                } else {
                    showToast(data.message || 'åŠ è½½æ–‡ç« åˆ—è¡¨å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('åŠ è½½æ–‡ç« åˆ—è¡¨å¤±è´¥', 'error');
                console.error('åŠ è½½æ–‡ç« åˆ—è¡¨å¤±è´¥:', error);
            }
        }
        
        // ç”Ÿæˆæ–‡ç« åˆ†é¡µ
        function generateArticlePagination(totalPages, currentPage) {
            const pagination = document.getElementById('article-pagination');
            pagination.innerHTML = '';
            
            // ä¸Šä¸€é¡µ
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'btn btn-sm btn-secondary';
                prevBtn.textContent = 'ä¸Šä¸€é¡µ';
                prevBtn.onclick = () => loadArticles(currentPage - 1);
                pagination.appendChild(prevBtn);
            }
            
            // é¡µç æŒ‰é’®
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-secondary'}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => loadArticles(i);
                pagination.appendChild(pageBtn);
            }
            
            // ä¸‹ä¸€é¡µ
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'btn btn-sm btn-secondary';
                nextBtn.textContent = 'ä¸‹ä¸€é¡µ';
                nextBtn.onclick = () => loadArticles(currentPage + 1);
                pagination.appendChild(nextBtn);
            }
        }
        
        // æ‰“å¼€æ–‡ç« ç¼–è¾‘æ¨¡æ€æ¡†
        function openArticleModal() {
            document.getElementById('article-modal-title').textContent = 'æ·»åŠ æ–‡ç« ';
            document.getElementById('article-id').value = '';
            document.getElementById('article-title').value = '';
            document.getElementById('article-content').value = '';
            document.getElementById('article-status').value = 'published';
            // è®¾ç½®é»˜è®¤é€‰ä¸­"å¦"
            document.querySelector('input[name="article-featured"][value="false"]').checked = true;
            document.getElementById('article-cover').value = '';
            
            // é‡ç½®å°é¢é¢„è§ˆ
            const coverPreview = document.getElementById('article-cover-preview');
            coverPreview.innerHTML = '<span>é¢„è§ˆåŒºåŸŸ</span>';
            
            document.getElementById('article-modal').style.display = 'flex';
            
            // å»¶è¿Ÿåˆå§‹åŒ–CKEditor 5ï¼Œç¡®ä¿æ¨¡æ€æ¡†å·²ç»æ˜¾ç¤º
            setTimeout(function() {
                try {
                    initCkeditor();
                } catch (error) {
                    console.error('åˆå§‹åŒ–CKEditorå¤±è´¥:', error);
                    // ç¡®ä¿æ–‡æœ¬åŒºåŸŸå¯ç¼–è¾‘
                    document.getElementById('article-content').readOnly = false;
                }
            }, 100);
        }
        
        // å…³é—­æ–‡ç« ç¼–è¾‘æ¨¡æ€æ¡†
        function closeArticleModal() {
            // ä¿å­˜å½“å‰å†…å®¹å¹¶é”€æ¯ç¼–è¾‘å™¨
            saveEditorContent();
            destroyEditor();
            
            document.getElementById('article-modal').style.display = 'none';
            // æ¸…ç©ºè¡¨å•
            document.getElementById('article-id').value = '';
            document.getElementById('article-title').value = '';
            document.getElementById('article-content').value = '';
            document.getElementById('article-status').value = 'published';
            document.querySelector('input[name="article-featured"][value="false"]').checked = true;
            document.getElementById('article-cover').value = '';
            document.getElementById('article-cover-preview').innerHTML = '<span>é¢„è§ˆåŒºåŸŸ</span>';
        }
        
        // åŠ è½½æ–‡ç« æ•°æ®
        async function loadArticleData(id) {
            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch(`http://8.136.34.190:3000/api/articles/${id}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const article = data.data;
                    document.getElementById('article-id').value = article.id;
                    document.getElementById('article-title').value = article.title;
                    
                    // å¤„ç†æ–‡ç« å†…å®¹ä¸­çš„å›¾ç‰‡URLï¼Œç¡®ä¿æŒ‡å‘åç«¯æœåŠ¡å™¨
                    let content = article.content;
                    // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…imgæ ‡ç­¾ä¸­çš„srcå±æ€§ï¼Œå°†ç›¸å¯¹è·¯å¾„çš„å›¾ç‰‡URLä¿®æ”¹ä¸ºæŒ‡å‘åç«¯æœåŠ¡å™¨
                    content = content.replace(/<img\s+[^>]*src=["']([^"']*\/uploads\/[^"']*)["'][^>]*>/g, function(match, src) {
                        // å¦‚æœä¸æ˜¯å®Œæ•´URLï¼Œåˆ™æ·»åŠ åç«¯æœåŠ¡å™¨åœ°å€
                        if (!src.startsWith('http')) {
                            return match.replace(src, 'http://8.136.34.190:3000' + src);
                        }
                        return match;
                    });
                    
                    document.getElementById('article-content').value = content;
                    // å°†å¸ƒå°”ç±»å‹çš„statusè½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²å€¼
                    const statusValue = article.status ? 'published' : 'draft';
                    document.getElementById('article-status').value = statusValue;
                    // æ ¹æ®æ–‡ç« çš„isFeaturedå€¼è®¾ç½®å•é€‰æŒ‰é’®
                    const featuredValue = article.isFeatured ? 'true' : 'false';
                    document.querySelector(`input[name="article-featured"][value="${featuredValue}"]`).checked = true;
                    
                    // è®¾ç½®å°é¢é¢„è§ˆ
                    const coverPreview = document.getElementById('article-cover-preview');
                    if (article.cover) {
                        // ç¡®ä¿å›¾ç‰‡URLæŒ‡å‘åç«¯æœåŠ¡å™¨
                        const coverUrl = article.cover;
                        // æ£€æŸ¥æ˜¯å¦å·²ç»åŒ…å«å®Œæ•´URLï¼Œå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„åˆ™æ·»åŠ åç«¯æœåŠ¡å™¨åœ°å€
                        const finalCoverUrl = coverUrl.startsWith('http') ? coverUrl : coverUrl;
                        coverPreview.innerHTML = `<img src="${finalCoverUrl}" alt="å°é¢">`;
                    } else {
                        coverPreview.innerHTML = '<span>é¢„è§ˆåŒºåŸŸ</span>';
                    }
                } else {
                    showToast(data.message || 'åŠ è½½æ–‡ç« æ•°æ®å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('åŠ è½½æ–‡ç« æ•°æ®å¤±è´¥', 'error');
                console.error('åŠ è½½æ–‡ç« æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // ç¼–è¾‘æ–‡ç« 
        function editArticle(id) {
            document.getElementById('article-modal-title').textContent = 'ç¼–è¾‘æ–‡ç« ';
            loadArticleData(id);
            document.getElementById('article-modal').style.display = 'flex';
            
            // å»¶è¿Ÿåˆå§‹åŒ–CKEditor 5ï¼Œç¡®ä¿æ¨¡æ€æ¡†å·²ç»æ˜¾ç¤ºä¸”æ•°æ®å·²åŠ è½½
            setTimeout(function() {
                try {
                    initCkeditor();
                    // CKEditorä¼šè‡ªåŠ¨è®¾ç½®å†…å®¹
                } catch (error) {
                    console.error('åˆå§‹åŒ–CKEditorå¤±è´¥:', error);
                    // ç¡®ä¿æ–‡æœ¬åŒºåŸŸå¯ç¼–è¾‘
                    document.getElementById('article-content').readOnly = false;
                }
            }, 200);
        }
        
        // åˆ é™¤æ–‡ç« 
        async function deleteArticle(id, title) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ç« "${title}"å—ï¼Ÿ`)) {
                try {
                    const token = localStorage.getItem('adminToken');
                    const response = await fetch(`http://8.136.34.190:3000/api/articles/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showToast('åˆ é™¤æˆåŠŸ', 'success');
                        loadArticles(currentPage);
                    } else {
                        showToast(data.message || 'åˆ é™¤å¤±è´¥', 'error');
                    }
                } catch (error) {
                    showToast('åˆ é™¤å¤±è´¥', 'error');
                    console.error('åˆ é™¤æ–‡ç« å¤±è´¥:', error);
                }
            }
        }
        
        // ä¿å­˜æ–‡ç« 
        async function saveArticle() {
            // ä¿å­˜ç¼–è¾‘å™¨å†…å®¹åˆ°textarea
            saveEditorContent();
            
            const id = document.getElementById('article-id').value;
            const title = document.getElementById('article-title').value.trim();
            const content = document.getElementById('article-content').value.trim();
            // è·å–çŠ¶æ€å€¼å¹¶è½¬æ¢ä¸ºå¸ƒå°”å€¼
            const statusStr = document.getElementById('article-status').value;
            const status = statusStr === 'published';
            // è·å–é€‰ä¸­çš„å•é€‰æŒ‰é’®å€¼å¹¶è½¬æ¢ä¸ºå¸ƒå°”å€¼
            const isFeatured = document.querySelector('input[name="article-featured"]:checked').value === 'true';
            const coverFile = document.getElementById('article-cover').files[0];
            
            // è¡¨å•éªŒè¯
            if (!title) {
                showToast('è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜', 'error');
                return;
            }
            
            if (!content) {
                showToast('è¯·è¾“å…¥æ–‡ç« å†…å®¹', 'error');
                return;
            }
            
            try {
                const token = localStorage.getItem('adminToken');
                const formData = new FormData();
                formData.append('title', title);
                
                // å°†æ–‡ç« å†…å®¹ä¸­çš„å›¾ç‰‡URLä»ç»å¯¹è·¯å¾„è½¬å›ç›¸å¯¹è·¯å¾„ï¼Œç¡®ä¿æ•°æ®åº“ä¸­å­˜å‚¨æ­£ç¡®æ ¼å¼
                let contentToSave = content;
                // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æŒ‡å‘æˆ‘ä»¬åç«¯æœåŠ¡å™¨çš„å›¾ç‰‡URLï¼Œå°†å…¶è½¬å›ç›¸å¯¹è·¯å¾„
                contentToSave = contentToSave.replace(/<img\s+[^>]*src=["']http:\/\/8\.136\.34\.190:3000([^"']*)["'][^>]*>/g, function(match, src) {
                    return match.replace('http://8.136.34.190:3000' + src, src);
                });
                formData.append('content', contentToSave);
                formData.append('status', status);
                formData.append('isFeatured', isFeatured);
                
                if (coverFile) {
                    formData.append('cover', coverFile);
                }
                
                // ä½¿ç”¨åç«¯æœåŠ¡å™¨å®Œæ•´åœ°å€
                let url = 'http://8.136.34.190:3000/api/articles';
                let method = 'POST';
                
                if (id) {
                    url += `/${id}`;
                    method = 'PUT';
                }
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(id ? 'æ›´æ–°æˆåŠŸ' : 'åˆ›å»ºæˆåŠŸ', 'success');
                    closeArticleModal();
                    loadArticles(currentPage);
                } else {
                    showToast(data.message || 'ä¿å­˜å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥', 'error');
                console.error('ä¿å­˜æ–‡ç« å¤±è´¥:', error);
            }
        }
        
        // ç›‘å¬å°é¢æ–‡ä»¶é€‰æ‹©ï¼Œæ˜¾ç¤ºé¢„è§ˆ
        document.getElementById('article-cover').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const coverPreview = document.getElementById('article-cover-preview');
            
            if (file) {
                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                if (!file.type.match('image.*')) {
                    showToast('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', 'error');
                    coverPreview.innerHTML = '<span>é¢„è§ˆåŒºåŸŸ</span>';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    coverPreview.innerHTML = `<img src="${event.target.result}" alt="å°é¢é¢„è§ˆ" style="max-width: 100%; max-height: 200px; object-fit: contain;">`;
                };
                reader.onerror = function() {
                    showToast('å›¾ç‰‡è¯»å–å¤±è´¥', 'error');
                    coverPreview.innerHTML = '<span>é¢„è§ˆåŒºåŸŸ</span>';
                };
                reader.readAsDataURL(file);
            } else {
                coverPreview.innerHTML = '<span>é¢„è§ˆåŒºåŸŸ</span>';
            }
        });
        
        // ä½œå“å›¾ç‰‡ç›¸å…³åŠŸèƒ½
        let imageOrder = [];
        
        // ç›‘å¬ä½œå“å›¾ç‰‡æ–‡ä»¶é€‰æ‹©ï¼Œæ˜¾ç¤ºé¢„è§ˆå¹¶æ”¯æŒå¢é‡ä¸Šä¼ 
        document.getElementById('product-images').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const imagesPreview = document.getElementById('images-preview');
            
            if (files.length > 0) {
                // æ£€æŸ¥æ˜¯å¦ä¸ºæ–°å¢ä½œå“ï¼ˆæ²¡æœ‰productIdï¼‰
                const productId = document.getElementById('product-id').value;
                if (!productId) {
                    // æ–°å¢ä½œå“ï¼šæ¸…ç©ºé¢„è§ˆåŒºå’ŒimageOrderæ•°ç»„
                    imagesPreview.innerHTML = '';
                    imageOrder = [];
                }
                
                // æŒ‰æ–‡ä»¶åä¸­çš„æ•°å­—æ’åºï¼ˆç”±å°åˆ°å¤§ï¼‰
                const sortedFiles = files.sort((a, b) => {
                    // æå–æ–‡ä»¶åä¸­çš„æ•°å­—è¿›è¡Œæ¯”è¾ƒ
                    const extractNumber = (filename) => {
                        const match = filename.match(/(\d+)/);
                        return match ? parseInt(match[1]) : 0;
                    };
                    
                    const numA = extractNumber(a.name);
                    const numB = extractNumber(b.name);
                    
                    // å¦‚æœéƒ½æœ‰æ•°å­—ï¼ŒæŒ‰æ•°å­—å¤§å°æ’åº
                    if (numA !== 0 && numB !== 0) {
                        return numA - numB;
                    }
                    
                    // å¦‚æœåªæœ‰ä¸€ä¸ªæœ‰æ•°å­—ï¼Œæœ‰æ•°å­—çš„æ’å‰é¢
                    if (numA !== 0) return -1;
                    if (numB !== 0) return 1;
                    
                    // å¦‚æœéƒ½æ²¡æœ‰æ•°å­—ï¼ŒæŒ‰å­—æ¯é¡ºåºæ’åº
                    return a.name.localeCompare(b.name);
                });
                
                console.log('åŸå§‹æ–‡ä»¶é¡ºåº:', files.map(f => f.name));
                console.log('æŒ‰æ–‡ä»¶åæ•°å­—æ’åºå:', sortedFiles.map(f => f.name));
                
                // æŒ‰æ’åºåçš„æ–‡ä»¶é¡ºåºå¤„ç†å›¾ç‰‡
                sortedFiles.forEach((file, fileIndex) => {
                    if (file.type.match('image.*')) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            // ç¼–è¾‘æ¨¡å¼ï¼šä½¿ç”¨ç°æœ‰æœ€å¤§orderå€¼ + 1
                            // æ–°å¢æ¨¡å¼ï¼šä½¿ç”¨å½“å‰æ•°ç»„é•¿åº¦ä½œä¸ºorder
                            const currentOrder = !productId ? imageOrder.length : 
                                Math.max(...imageOrder.map(img => img.order), -1) + 1;
                            
                            console.log(`æ·»åŠ å›¾ç‰‡ - æ–‡ä»¶: ${file.name}, Order: ${currentOrder}, æ¨¡å¼: ${productId ? 'ç¼–è¾‘' : 'æ–°å¢'}`);
                            
                            const imageContainer = createImagePreviewItem(event.target.result, currentOrder, true);
                            imagesPreview.appendChild(imageContainer);
                            imageOrder.push({
                                url: event.target.result,
                                order: currentOrder,
                                file: file,
                                isNew: true // æ ‡è®°ä¸ºæ–°å›¾ç‰‡
                            });
                            
                            console.log('å½“å‰imageOrderæ•°ç»„:', imageOrder);
                            
                            // æ›´æ–°åºå·æ˜¾ç¤º
                            updateOrderNumbers();
                        };
                        reader.readAsDataURL(file);
                    }
                });
                
                // æ¸…ç©ºæ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡å¤é€‰æ‹©ç›¸åŒæ–‡ä»¶
                e.target.value = '';
            }
        });
        
        // åˆ›å»ºå›¾ç‰‡é¢„è§ˆé¡¹
        function createImagePreviewItem(imageSrc, order, isNew = false) {
            const container = document.createElement('div');
            container.className = 'image-preview-item';
            container.dataset.order = order;
            container.dataset.isNew = isNew;
            
            const img = document.createElement('img');
            img.src = imageSrc;
            img.alt = 'ä½œå“å›¾ç‰‡é¢„è§ˆ';
            
            // æ·»åŠ åºå·æ˜¾ç¤º - æ˜¾ç¤ºä¸ºorder + 1ï¼Œå› ä¸ºorderä»0å¼€å§‹
            const orderNumber = document.createElement('div');
            orderNumber.className = 'order-number';
            orderNumber.textContent = order + 1;
            
            const controls = document.createElement('div');
            controls.className = 'image-controls';
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.innerHTML = 'Ã—';
            deleteBtn.onclick = function(e) {
                e.stopPropagation();
                deleteImage(container, isNew);
            };
            
            controls.appendChild(deleteBtn);
            
            container.appendChild(orderNumber);
            container.appendChild(img);
            container.appendChild(controls);
            
            console.log(`åˆ›å»ºé¢„è§ˆé¡¹ - Order: ${order}, æ˜¾ç¤ºåºå·: ${order + 1}, æ˜¯å¦æ–°å›¾ç‰‡: ${isNew}`);
            
            return container;
        }
        
        // æ›´æ–°åºå·æ˜¾ç¤º
        function updateOrderNumbers() {
            const allItems = document.querySelectorAll('.image-preview-item');
            allItems.forEach((item, index) => {
                const orderNumber = item.querySelector('.order-number');
                if (orderNumber) {
                    orderNumber.textContent = index + 1;
                }
            });
        }
        
        // åˆ é™¤å›¾ç‰‡ï¼ˆæ”¯æŒå¢é‡åˆ é™¤ï¼‰
        async function deleteImage(container, isNew) {
            const order = parseInt(container.dataset.order);
            const isImageNew = container.dataset.isNew === 'true';
            
            // å¦‚æœæ˜¯ç°æœ‰å›¾ç‰‡ä¸”åœ¨ç¼–è¾‘æ¨¡å¼ï¼Œè°ƒç”¨åˆ é™¤API
            if (!isImageNew && document.getElementById('product-id').value) {
                try {
                    const productId = document.getElementById('product-id').value;
                    const token = localStorage.getItem('adminToken');
                    
                    const response = await fetch(`/api/products/${productId}/images/${order}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        showToast('å›¾ç‰‡å·²åˆ é™¤', 'success');
                    } else {
                        showToast(data.message || 'åˆ é™¤å¤±è´¥', 'error');
                        return;
                    }
                } catch (error) {
                    showToast('åˆ é™¤å¤±è´¥', 'error');
                    console.error('åˆ é™¤å›¾ç‰‡å¤±è´¥:', error);
                    return;
                }
            } else {
                showToast('å›¾ç‰‡å·²åˆ é™¤', 'info');
            }
            
            container.remove();
            
            // ä»imageOrderæ•°ç»„ä¸­ç§»é™¤
            imageOrder = imageOrder.filter(img => img.order !== order);
            
            // é‡æ–°æ›´æ–°åºå·æ˜¾ç¤º
            updateOrderNumbers();
        }
        
        // ä¿®æ”¹ä¿å­˜ä½œå“å‡½æ•°ï¼Œæ”¯æŒå¢é‡ä¸Šä¼ å’Œå›¾ç‰‡é¡ºåº
        async function saveProductWithOrder() {
            const id = document.getElementById('product-id').value;
            const title = document.getElementById('product-title').value;
            const description = document.getElementById('product-description').value;
            const stars = document.getElementById('product-stars').value;
            const tags = document.getElementById('product-tags').value;
            const featured = document.querySelector('input[name="product-featured"]:checked').value === 'true';
            const coverFile = document.getElementById('product-cover').files[0];
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            if (!title) {
                showToast('è¯·å¡«å†™ä½œå“æ ‡é¢˜', 'error');
                return;
            }
            
            if (!id && !coverFile) {
                showToast('è¯·ä¸Šä¼ ä½œå“å°é¢', 'error');
                return;
            }
            
            // å¤„ç†æ ‡ç­¾
            const tagsArray = tags ? tags.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
            
            try {
                const token = localStorage.getItem('adminToken');
                
                if (id) {
                    // ç¼–è¾‘æ¨¡å¼ï¼šå…ˆä¸Šä¼ æ–°å›¾ç‰‡ï¼ˆå¢é‡ä¸Šä¼ ï¼‰
                    const newImages = imageOrder.filter(img => img.isNew && img.file);
                    let uploadData = { success: true, data: { newImages: [] } };
                    
                    if (newImages.length > 0) {
                        console.log('å‡†å¤‡ä¸Šä¼ æ–°å›¾ç‰‡æ•°é‡:', newImages.length);
                        
                        const formData = new FormData();
                        newImages.forEach((imageItem, index) => {
                            console.log(`ä¸Šä¼ æ–°å›¾ç‰‡ ${index}:`, imageItem.file.name);
                            formData.append('images', imageItem.file);
                            // è®°å½•ä¸´æ—¶é¡ºåºï¼Œç”¨äºåç»­å…³è”
                            imageItem.tempOrder = index + 1;
                        });
                        
                        const uploadResponse = await fetch(`/api/products/${id}/images`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            },
                            body: formData,
                            credentials: 'include'
                        });
                        
                        uploadData = await uploadResponse.json();
                        console.log('æ–°å›¾ç‰‡ä¸Šä¼ å“åº”:', uploadData);
                        
                        if (!uploadResponse.ok || !uploadData.success) {
                            // æ ¹æ®é”™è¯¯ç±»å‹æä¾›æ›´å…·ä½“çš„æç¤º
                            let errorMessage = 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥';
                            if (uploadData.message) {
                                if (uploadData.message.includes('size') || uploadData.message.includes('large')) {
                                    errorMessage = 'å›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©æ›´å°çš„å›¾ç‰‡æ–‡ä»¶';
                                } else if (uploadData.message.includes('type') || uploadData.message.includes('format')) {
                                    errorMessage = 'å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒï¼Œè¯·é€‰æ‹©JPGã€PNGç­‰å¸¸è§æ ¼å¼';
                                } else if (uploadData.message.includes('limit') || uploadData.message.includes('æ•°é‡')) {
                                    errorMessage = 'å›¾ç‰‡æ•°é‡è¶…å‡ºé™åˆ¶ï¼Œè¯·å‡å°‘å›¾ç‰‡æ•°é‡';
                                } else {
                                    errorMessage = 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ' + uploadData.message;
                                }
                            } else if (uploadResponse.status === 413) {
                                errorMessage = 'å›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©æ›´å°çš„å›¾ç‰‡æ–‡ä»¶';
                            } else if (uploadResponse.status === 415) {
                                errorMessage = 'å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒï¼Œè¯·é€‰æ‹©JPGã€PNGç­‰å¸¸è§æ ¼å¼';
                            } else if (uploadResponse.status >= 500) {
                                errorMessage = 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•å›¾ç‰‡ä¸Šä¼ ';
                            }
                            
                            showToast(errorMessage, 'error');
                            return;
                        }
                    } else {
                        console.log('æ²¡æœ‰æ–°å›¾ç‰‡éœ€è¦ä¸Šä¼ ');
                    }
                    
                    // æ›´æ–°ä½œå“åŸºæœ¬ä¿¡æ¯
                    const formData = new FormData();
                    formData.append('title', title);
                    formData.append('description', description || '');
                    formData.append('stars', stars || 0);
                    formData.append('tags', JSON.stringify(tagsArray));
                    formData.append('featured', featured ? 'true' : 'false');
                    
                    // æ·»åŠ å°é¢æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
                    if (coverFile) {
                        formData.append('cover', coverFile);
                    }
                    
                    const response = await fetch(`http://8.136.34.190:3000/api/products/${id}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        },
                        body: formData,
                        credentials: 'include'
                    });
                    
                    const data = await response.json();
                    if (response.ok && data.success) {
                        // æ›´æ–°å›¾ç‰‡é¡ºåºï¼ˆå¤„ç†æ‰€æœ‰å›¾ç‰‡ï¼šç°æœ‰å›¾ç‰‡+æ–°ä¸Šä¼ å›¾ç‰‡ï¼‰
                        const imageContainer = document.getElementById('images-preview');
                        const imageItems = imageContainer.querySelectorAll('.image-preview-item');
                        
                        // æ„å»ºå®Œæ•´çš„å›¾ç‰‡æ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰å›¾ç‰‡ï¼ˆç°æœ‰+æ–°å¢ï¼‰
                        const allImages = [];
                        
                        // é¦–å…ˆå¤„ç†æ–°ä¸Šä¼ çš„å›¾ç‰‡ï¼Œå»ºç«‹URLæ˜ å°„
                        const newImageMap = new Map();
                        if (uploadData.success && uploadData.data && uploadData.data.newImages) {
                            // è·å–å½“å‰æ–°ä¸Šä¼ çš„å›¾ç‰‡åˆ—è¡¨
                            const currentNewImages = imageOrder.filter(img => img.isNew);
                            console.log('å½“å‰æ–°ä¸Šä¼ å›¾ç‰‡æ•°é‡:', currentNewImages.length);
                            console.log('æœåŠ¡å™¨è¿”å›çš„æ–°å›¾ç‰‡:', uploadData.data.newImages);
                            
                            // å»ºç«‹base64åˆ°çœŸå®URLçš„æ˜ å°„
                            currentNewImages.forEach((newImg, index) => {
                                if (index < uploadData.data.newImages.length) {
                                    const serverImg = uploadData.data.newImages[index];
                                    // ä½¿ç”¨base64 URLä½œä¸ºkeyï¼Œæ˜ å°„åˆ°çœŸå®URL
                                    newImageMap.set(newImg.url, serverImg.url);
                                    console.log(`å»ºç«‹æ˜ å°„: ${newImg.url.substring(0, 50)}... -> ${serverImg.url}`);
                                }
                            });
                        }
                        
                        console.log('æ–°å›¾ç‰‡URLæ˜ å°„:', Array.from(newImageMap.entries()));
                        console.log('å½“å‰imageOrderæ•°ç»„:', imageOrder);
                        
                        // è¯¦ç»†è°ƒè¯•ï¼šè®°å½•æ¯ä¸ªæ­¥éª¤
                        console.log('=== å¼€å§‹è¯¦ç»†è°ƒè¯•å›¾ç‰‡å¤„ç†è¿‡ç¨‹ï¼ˆä¿®å¤ç‰ˆæœ¬ï¼‰ ===');
                        console.log('DOMä¸­çš„å›¾ç‰‡é¡¹æ•°é‡:', imageItems.length);
                        console.log('imageOrderæ•°ç»„é•¿åº¦:', imageOrder.length);
                        
                        // ä¿®å¤ï¼šç›´æ¥æŒ‰DOMé¡ºåºå¤„ç†å›¾ç‰‡ï¼Œé¿å…é‡å¤
                        imageItems.forEach((item, domIndex) => {
                            const imgElement = item.querySelector('img');
                            if (imgElement) {
                                const domImageUrl = imgElement.getAttribute('src');
                                console.log(`DOMé¡¹ ${domIndex}: ${domImageUrl}`);
                                
                                // æ£€æŸ¥æ˜¯å¦æ˜¯æ–°ä¸Šä¼ çš„å›¾ç‰‡ï¼ˆbase64æ ¼å¼ï¼‰
                                if (domImageUrl.startsWith('data:image')) {
                                    // è¿™æ˜¯æ–°ä¸Šä¼ çš„å›¾ç‰‡ï¼Œéœ€è¦ä»æ˜ å°„ä¸­è·å–çœŸå®URL
                                    const realUrl = newImageMap.get(domImageUrl);
                                    if (realUrl) {
                                        allImages.push({
                                            url: realUrl,
                                            order: domIndex + 1
                                        });
                                        console.log(`âœ… æ–°å›¾ç‰‡: ${domImageUrl.substring(0, 50)}... -> ${realUrl} (order: ${domIndex + 1})`);
                                    } else {
                                        console.warn(`âš ï¸ æ–°å›¾ç‰‡æ˜ å°„å¤±è´¥: ${domImageUrl.substring(0, 50)}...`);
                                    }
                                } else {
                                    // è¿™æ˜¯ç°æœ‰å›¾ç‰‡ï¼Œç›´æ¥ä½¿ç”¨
                                    allImages.push({
                                        url: domImageUrl,
                                        order: domIndex + 1
                                    });
                                    console.log(`âœ… ç°æœ‰å›¾ç‰‡: ${domImageUrl} (order: ${domIndex + 1})`);
                                }
                            }
                        });
                        
                        console.log('\n=== å›¾ç‰‡å¤„ç†å®Œæˆ ===');
                        console.log('æœ€ç»ˆallImagesæ•°ç»„:', allImages);
                        console.log('é¢„æœŸå›¾ç‰‡æ•°é‡:', imageItems.length);
                        console.log('å®é™…å¤„ç†æ•°é‡:', allImages.length);
                        
                        if (allImages.length !== imageItems.length) {
                            console.warn('âš ï¸ è­¦å‘Šï¼šå¤„ç†çš„å›¾ç‰‡æ•°é‡ä¸DOMæ•°é‡ä¸ç¬¦ï¼');
                        }
                        
                        console.log('å‘é€çš„å®Œæ•´å›¾ç‰‡æ•°ç»„ï¼ˆåŒ…å«ç°æœ‰+æ–°å¢ï¼‰:', allImages);
                        
                        // åªæœ‰å½“æœ‰å›¾ç‰‡æ—¶æ‰æ›´æ–°é¡ºåº
                        if (allImages.length > 0) {
                            try {
                                const orderResponse = await fetch(`/api/products/${id}/images/reorder`, {
                                    method: 'PUT',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'Authorization': `Bearer ${token}`
                                    },
                                    body: JSON.stringify({ images: allImages }),
                                    credentials: 'include'
                                });
                                
                                const orderData = await orderResponse.json();
                                if (!orderResponse.ok || !orderData.success) {
                                    console.error('å›¾ç‰‡é¡ºåºæ›´æ–°å¤±è´¥:', orderData.message);
                                    showToast(`å›¾ç‰‡é¡ºåºæ›´æ–°å¤±è´¥: ${orderData.message}`, 'error');
                                    return;
                                } else {
                                    console.log('å›¾ç‰‡é¡ºåºæ›´æ–°æˆåŠŸ:', orderData);
                                }
                            } catch (orderError) {
                                console.error('å›¾ç‰‡é¡ºåºæ›´æ–°è¯·æ±‚å¤±è´¥:', orderError);
                                showToast('å›¾ç‰‡é¡ºåºæ›´æ–°è¯·æ±‚å¤±è´¥', 'error');
                                return;
                            }
                        }
                        
                        showToast('æ›´æ–°æˆåŠŸ', 'success');
                        closeProductModal();
                        loadProducts();
                    } else {
                        console.error('æ›´æ–°å¤±è´¥:', data);
                        
                        // æ ¹æ®é”™è¯¯ç±»å‹æä¾›æ›´å…·ä½“çš„æç¤º
                        let errorMessage = 'æ›´æ–°å¤±è´¥';
                        if (data.message) {
                            if (data.message.includes('file') || data.message.includes('upload') || data.message.includes('å›¾ç‰‡') || data.message.includes('cover')) {
                                errorMessage = 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ' + data.message;
                            } else if (data.message.includes('size') || data.message.includes('large')) {
                                errorMessage = 'æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©æ›´å°çš„æ–‡ä»¶';
                            } else if (data.message.includes('type') || data.message.includes('format')) {
                                errorMessage = 'æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„æ–‡ä»¶æ ¼å¼';
                            } else {
                                errorMessage = data.message;
                            }
                        } else if (response.status === 413) {
                            errorMessage = 'æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©æ›´å°çš„æ–‡ä»¶';
                        } else if (response.status === 415) {
                            errorMessage = 'æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„æ–‡ä»¶æ ¼å¼';
                        } else if (response.status >= 500) {
                            errorMessage = 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
                        }
                        
                        showToast(errorMessage, 'error');
                    }
                } else {
                    // æ–°å¢æ¨¡å¼ï¼šä½¿ç”¨åŸæœ‰é€»è¾‘
                    const formData = new FormData();
                    formData.append('title', title);
                    formData.append('description', description || '');
                    formData.append('stars', stars || 0);
                    formData.append('tags', JSON.stringify(tagsArray));
                    formData.append('featured', featured ? 'true' : 'false');
                    formData.append('date', new Date().toISOString().split('T')[0]);
                    
                    // æ·»åŠ å°é¢æ–‡ä»¶
                    if (coverFile) {
                        formData.append('cover', coverFile);
                    }
                    
                    // æŒ‰DOMä¸­çš„å®é™…é¡ºåºæ·»åŠ ä½œå“å›¾ç‰‡æ–‡ä»¶
                    const imageContainer = document.getElementById('images-preview');
                    const imageItems = imageContainer.querySelectorAll('.image-preview-item');
                    
                    // æŒ‰DOMé¡ºåºé‡æ–°æ„å»ºimageOrderæ•°ç»„
                    const orderedImages = [];
                    imageItems.forEach((item, domIndex) => {
                        const order = parseInt(item.getAttribute('data-order'));
                        const imageItem = imageOrder.find(img => img.order === order);
                        if (imageItem && imageItem.file) {
                            orderedImages.push({
                                ...imageItem,
                                order: domIndex // æ›´æ–°orderä¸ºDOMä¸­çš„å®é™…é¡ºåº
                            });
                        }
                    });
                    
                    // åªæœ‰å½“ç¡®å®æœ‰å›¾ç‰‡æ–‡ä»¶æ—¶æ‰æ·»åŠ åˆ°FormData
                    if (orderedImages.length > 0) {
                        console.log('å‡†å¤‡ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶æ•°é‡:', orderedImages.length);
                        orderedImages.forEach((imageItem, index) => {
                            console.log(`ä¸Šä¼ å›¾ç‰‡ ${index}:`, imageItem.file.name);
                            formData.append('images', imageItem.file);
                        });
                    } else {
                        console.log('æ²¡æœ‰å›¾ç‰‡æ–‡ä»¶éœ€è¦ä¸Šä¼ ');
                    }
                    
                    const response = await fetch('http://8.136.34.190:3000/api/products', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        },
                        body: formData,
                        credentials: 'include'
                    });
                    
                    console.log('å“åº”çŠ¶æ€:', response.status);
                    console.log('å“åº”å¤´:', response.headers);
                    
                    const data = await response.json();
                    console.log('å“åº”æ•°æ®:', data);
                    
                    if (response.ok && data.success) {
                        showToast('æ·»åŠ æˆåŠŸ', 'success');
                        closeProductModal();
                        loadProducts();
                    } else {
                        console.error('æ·»åŠ å¤±è´¥:', data);
                        
                        // æ ¹æ®é”™è¯¯ç±»å‹æä¾›æ›´å…·ä½“çš„æç¤º
                        let errorMessage = 'æ·»åŠ å¤±è´¥';
                        if (data.message) {
                            if (data.message.includes('file') || data.message.includes('upload') || data.message.includes('å›¾ç‰‡')) {
                                errorMessage = 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ' + data.message;
                            } else if (data.message.includes('size') || data.message.includes('large')) {
                                errorMessage = 'æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©æ›´å°çš„æ–‡ä»¶';
                            } else if (data.message.includes('type') || data.message.includes('format')) {
                                errorMessage = 'æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„æ–‡ä»¶æ ¼å¼';
                            } else {
                                errorMessage = data.message;
                            }
                        } else if (response.status === 413) {
                            errorMessage = 'æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©æ›´å°çš„æ–‡ä»¶';
                        } else if (response.status === 415) {
                            errorMessage = 'æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„æ–‡ä»¶æ ¼å¼';
                        } else if (response.status >= 500) {
                            errorMessage = 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
                        }
                        
                        showToast(errorMessage, 'error');
                    }
                }
            } catch (error) {
                showToast(`æ“ä½œå¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.className = 'toast';
            }, 3000);
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            if (!dateString) return '';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            
            return date.toLocaleDateString('zh-CN');
        }
        
        // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // æš´éœ²å‡½æ•°åˆ°å…¨å±€
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        window.editUser = editUser;
        window.deleteUser = deleteUser;
        window.editArticle = editArticle;
        window.deleteArticle = deleteArticle;
    </script>
    </body>
</html>